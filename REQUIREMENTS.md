# Требования и функциональность

## Функциональные требования

### FR-1: Доступ к веб-камере
- **Приоритет**: Высокий
- **Описание**: Приложение должно запрашивать и получать доступ к веб-камере пользователя через WebRTC API
- **Критерии приёмки**:
  - Запрос разрешения на доступ к камере при первом запуске
  - Обработка случая, когда пользователь отклоняет доступ
  - Отображение видео-потока с камеры (опционально, для отладки)
  - Поддержка разрешения минимум 640x480
  - Частота кадров: ~30 FPS

### FR-2: Отслеживание положения головы
- **Приоритет**: Высокий
- **Описание**: Использование MediaPipe Face Landmarker для отслеживания head pose (translation X/Y/Z)
- **Критерии приёмки**:
  - Инициализация MediaPipe Face Landmarker при загрузке приложения
  - Обработка каждого кадра видео
  - Извлечение translation X/Y/Z координат головы относительно камеры
  - Фильтрация и сглаживание данных для уменьшения jitter
  - Обработка случая, когда лицо не обнаружено в кадре

### FR-3: Преобразование Z-translation в расстояние до монитора (РМ)
- **Приоритет**: Высокий
- **Описание**: Преобразование Z-translation от MediaPipe в реальное расстояние пользователя до монитора
- **Критерии приёмки**:
  - Корректное маппирование Z-translation в диапазон РМ (30 см - 1.5 м)
  - Калибровка для разных размеров экранов (27" десктоп, 14-15" ноутбук)
  - Поддержка настройки калибровки (возможно, в будущем)

### FR-4: Алгоритм масштабирования на основе углового размера
- **Приоритет**: Высокий
- **Описание**: Преобразование линейного изменения РМ в нелинейный процент отображения ФИ
- **Критерии приёмки**:
  - Реализация формулы углового размера экрана: α = 2 × arctan(W / (2 × L))
  - Корректный расчёт при РМ от 30 см до 1.5 м
  - УРЭ растёт от ~28° до ~180° в рабочем диапазоне
  - Преобразование УРЭ в процент отображения ФИ (начальное значение ~50%)
  - Плавное изменение масштаба без резких скачков

### FR-5: Алгоритм панорамирования
- **Приоритет**: Высокий
- **Описание**: Сдвиг viewport по ФИ при движении головы влево/вправо/вверх/вниз
- **Критерии приёмки**:
  - Смещение головы влево → сдвиг viewport вправо по ФИ
  - Смещение головы вправо → сдвиг viewport влево по ФИ
  - Смещение головы вверх → сдвиг viewport ВВЕРХ по ФИ
  - Смещение головы вниз → сдвиг viewport ВНИЗ по ФИ
  - Масштаб ФИ не меняется при панорамировании
  - Ограничение границ viewport (нельзя выйти за пределы ФИ, + плавное торможение у границ)

### FR-6: Отображение фонового изображения (ФИ)
- **Приоритет**: Высокий
- **Описание**: Загрузка и отображение ФИ с применением текущего viewport (масштаб и позиция)
- **Критерии приёмки**:
  - ФИ загружается при старте приложения (захардкожено для MVP)
  - Размер ФИ: 2-3× размер экрана в пикселях
  - Начальное состояние: показывается ~50% ФИ (центральная часть)
  - Рендеринг на canvas с применением трансформаций
  - Плавное обновление при изменении viewport

### FR-7: Управление интерфейсом
- **Приоритет**: Средний
- **Описание**: UI элементы для управления приложением
- **Критерии приёмки**:
  - Кнопка старт/стоп для начала/остановки отслеживания
  - Отображение статуса (ожидание камеры, отслеживание, ошибка)
  - Статус-бар внизу экрана с версией и временем билда
  - Информативные сообщения об ошибках

## Нефункциональные требования

### NFR-1: Производительность
- **Требование**: Обработка видео с камеры должна работать на ~30 FPS
- **Метрика**: Средний FPS обработки MediaPipe ≥ 28 FPS
- **Примечание**: Относится к обработке видео с камеры (MediaPipe), а не к рендерингу

### NFR-2: Совместимость браузеров
- **Требование**: Работа в современных браузерах
- **Минимальные версии**:
  - Chrome 90+
  - Firefox 88+
  - Edge 90+
  - Safari 14+ (с ограничениями)
- **Зависимости**: WebRTC API, WebGL (для будущей интеграции Three.js)

### NFR-3: Отзывчивость
- **Требование**: Минимальная задержка между движением головы и изменением изображения
- **Метрика**: Задержка < 100ms (≈ 3 кадра при 30 FPS)

### NFR-4: Стабильность
- **Требование**: Приложение не должно падать при ошибках камеры или MediaPipe
- **Критерии**:
  - Graceful degradation при отсутствии камеры
  - Обработка ошибок инициализации MediaPipe
  - Обработка случая, когда лицо выходит из кадра

### NFR-5: Код качество
- **Требование**: Соответствие стандартам кодирования проекта
- **Критерии**:
  - ESLint с конфигурацией Airbnb
  - JSDoc комментарии для всех функций
  - Читаемый и поддерживаемый код

## Технические требования

### TR-1: Зависимости
- **MediaPipe**: @mediapipe/face_mesh или @mediapipe/tasks-vision
- **Three.js**: (будущее) для системы частиц
- **Минимум зависимостей**: Стараться использовать нативные Web APIs где возможно

### TR-2: Структура проекта
- Модульная архитектура (отдельные файлы для каждого компонента)
- Использование ES6 модулей
- Следование структуре, описанной в PROJECT.md

### TR-3: Версионирование
- Семантическое версионирование (SemVer)
- PATCH инкрементируется после каждого раунда "Автор запросил - Cursor ответил"
- Версия и билд (yyyy-mm-dd hh.mm.ss) отображаются в статус-баре

## Ограничения и известные проблемы

### ОГ-1: Требуется камера
- Приложение не работает без веб-камеры
- Требуется разрешение пользователя на доступ к камере

### ОГ-2: Освещение
- Точность отслеживания зависит от освещения
- Плохое освещение может привести к нестабильному отслеживанию

### ОГ-3: Позиционирование
- Требуется, чтобы лицо пользователя было в кадре камеры
- Работает лучше, когда пользователь находится прямо перед экраном

### ОГ-4: Производительность
- Требуется достаточно мощное устройство для обработки видео в реальном времени
- Старые устройства могут не достигать 30 FPS

### ОГ-5: Браузерные ограничения
- Некоторые браузеры могут блокировать доступ к камере без HTTPS
- Требуется HTTPS для работы в production (или localhost для разработки)
